# JU-CONNECT

## é¡¹ç›®èƒŒæ™¯

1. å‰ç«¯å¼€å‘éœ€è¦è°ƒç”¨åå°çš„æ¥å£
2. ä½¿ç”¨ç°æˆçš„ç³»ç»ŸåŠŸèƒ½ï¼Œå°±æ¯”å¦‚ï¼šhttp://api.btstu.cn/

==> **åšä¸€ä¸ªAPIæ¥å£å¹³å°**

- è€ƒè™‘å®‰å…¨æ€§ï¼Œé˜²æ­¢æ”»å‡»
- ä¸èƒ½éšæ„è°ƒç”¨ï¼ˆé™æµã€å¼€é€šæœåŠ¡ï¼‰
- ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°
- è®¡è´¹
- æµé‡ä¿æŠ¤
- APIæ¥å£æ¥å…¥
- â€¦â€¦

## é¡¹ç›®ä»‹ç»

ä¸€ä¸ªæä¾›APIæ¥å£è°ƒç”¨çš„å¹³å°ï¼Œç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•ã€å¼€é€šæ¥å£è°ƒç”¨æƒé™ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¥å£ï¼Œå¹¶ä¸”æ¯æ¬¡è°ƒç”¨ä¼šè¿›è¡Œç»Ÿè®¡ã€‚ç®¡ç†å‘˜å¯ä»¥å‘å¸ƒæ¥å£ã€ä¸‹çº¿æ¥å£ã€æ¥å…¥æ¥å£ï¼Œä»¥åŠå¯è§†åŒ–æ¥å£çš„è°ƒç”¨æƒ…å†µã€æ•°æ®ã€‚

## é¡¹ç›®æµç¨‹

![æµç¨‹å›¾](assets/process-img.png)

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ assets
â”œâ”€â”€ doc
â”‚Â Â  â””â”€â”€ sql
â”‚Â Â      â”œâ”€â”€ create_table.sql
â”‚Â Â      â””â”€â”€ data.sql
â”œâ”€â”€ ju-connect-common
â”œâ”€â”€ ju-connect-dubbo-api
â”œâ”€â”€ ju-connect-gateway
â”œâ”€â”€ ju-connect-model
â”œâ”€â”€ ju-connect-web
â”œâ”€â”€ other-module
â”‚Â Â  â”œâ”€â”€ Mock-Interface
â”‚Â Â  â””â”€â”€ Mock-Interface-SDK
â””â”€â”€ pom.xml
```

## å¿«é€Ÿå¯åŠ¨

1. æ‰“å¼€`Mock-Interfae-SDK`é¡¹ç›®ï¼Œæ‰§è¡Œ`mvn install`ï¼Œæœ¬åœ°å®‰è£…SDKä¾èµ–
2. æ‰“å¼€`Mock-Interface`é¡¹ç›®ï¼Œä¿®æ”¹`application.yml`é…ç½®ï¼ˆé€‚åˆè‡ªå·±çš„ç¯å¢ƒï¼‰ï¼Œå¯åŠ¨å³å¯
3. æ‰§è¡Œ`doc/sql`ç›®å½•ä¸‹çš„ä¸¤ä¸ªSQLæ–‡ä»¶
4. æ‰“å¼€`Ju-Connect-backend`é¡¹ç›®ï¼Œä¿®æ”¹webæ¨¡å—ä¸‹`application-dev.yml`ä¸­çš„æ•°æ®åº“é…ç½®ã€Nacosé…ç½®ã€Dubboé…ç½®ï¼Œä¿®æ”¹gatewayæ¨¡å—ä¸‹`application-dev.yml`çš„Nacosé…ç½®ã€Dubboé…ç½®
5. å¯åŠ¨Gatewayæ¨¡å—å’ŒWebæ¨¡å—
6. è®¿é—®`http://localhost:port/api/doc.html`ï¼Œå…¶ä¸­ipä¸ºwebæ¨¡å—å¯åŠ¨çš„ç«¯å£å·
7. åœ¨Knife4jç•Œé¢è°ƒè¯•å³å¯

## é¡¹ç›®äº®ç‚¹

1. æ ¹æ®ä¸šåŠ¡æµç¨‹ï¼Œå°†æ•´ä¸ªé¡¹ç›®åç«¯åˆ’åˆ†ä¸º web ç³»ç»Ÿã€æ¨¡æ‹Ÿæ¥å£ã€å…¬å…±æ¨¡å—ã€å®¢æˆ·ç«¯ SDKã€API ç½‘å…³è¿™ 5 ä¸ªå­é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨ Maven è¿›è¡Œå¤šæ¨¡å—ä¾èµ–ç®¡ç†å’Œæ‰“åŒ…ã€‚
2. åç«¯ä½¿ç”¨ Swagger + Knife4j è‡ªåŠ¨ç”Ÿæˆ OpenAPI è§„èŒƒçš„æ¥å£æ–‡æ¡£ï¼Œå‰ç«¯åœ¨æ­¤åŸºç¡€ä¸Šä½¿ç”¨æ’ä»¶è‡ªåŠ¨ç”Ÿæˆæ¥å£è¯·æ±‚ä»£ç ï¼Œé™ä½å‰åç«¯åä½œæˆæœ¬ã€‚
3. ä¸ºé˜²æ­¢æ¥å£è¢«æ¶æ„è°ƒç”¨ï¼Œè®¾è®¡ API ç­¾åè®¤è¯ç®—æ³•ï¼Œä¸ºç”¨æˆ·åˆ†é…å”¯ä¸€ ak / sk ä»¥é‰´æƒï¼Œä¿éšœè°ƒç”¨çš„å®‰å…¨æ€§ã€å¯æº¯æºæ€§ï¼ˆæŒ‡ä¾¿äºç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°ï¼‰ã€‚
4. ä¸ºè§£å†³å¼€å‘è€…è°ƒç”¨æˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼ˆé¡»è‡ªå·±ä½¿ç”¨ HTTP + å°è£…ç­¾åå»è°ƒç”¨æ¥å£ï¼Œå¹³å‡ 20 è¡Œå·¦å³ä»£ç ï¼‰ï¼ŒåŸºäº Spring Boot Starter å¼€å‘äº†å®¢æˆ·ç«¯ SDKï¼Œä¸€è¡Œä»£ç  å³å¯è°ƒç”¨æ¥å£ï¼Œæé«˜å¼€å‘ä½“éªŒã€‚
5. é€‰ç”¨ Spring Cloud Gateway ä½œä¸º API ç½‘å…³ï¼Œå®ç°äº†è·¯ç”±è½¬å‘ã€è®¿é—®æ§åˆ¶ã€æµé‡æŸ“è‰²ï¼Œå¹¶é›†ä¸­å¤„ç†ç­¾åæ ¡éªŒã€è¯·æ±‚å‚æ•°æ ¡éªŒã€æ¥å£è°ƒç”¨ç»Ÿè®¡ç­‰ä¸šåŠ¡é€»è¾‘ï¼Œæé«˜å®‰å…¨æ€§çš„åŒæ—¶ã€ä¾¿äºç³»ç»Ÿå¼€å‘ç»´æŠ¤ã€‚
6. ä¸ºè§£å†³å¤šä¸ªå­ç³»ç»Ÿå†…ä»£ç å¤§é‡é‡å¤çš„é—®é¢˜ï¼ŒæŠ½è±¡æ¨¡å‹å±‚å’Œä¸šåŠ¡å±‚ä»£ç ä¸ºå…¬å…±æ¨¡å—ï¼Œå¹¶ä½¿ç”¨ Dubbo RPC æ¡†æ¶å®ç°å­ç³»ç»Ÿé—´çš„é«˜æ€§èƒ½æ¥å£è°ƒç”¨ï¼Œå¤§å¹…å‡å°‘é‡å¤ä»£ç ã€‚

# Core

## API ç­¾åè®¤è¯

> ä¸ºé˜²æ­¢æ¥å£è¢«æ¶æ„è°ƒç”¨ï¼Œè®¾è®¡ API ç­¾åè®¤è¯ç®—æ³•ï¼Œä¸ºç”¨æˆ·åˆ†é…å”¯ä¸€ ak / sk ä»¥é‰´æƒï¼Œä¿éšœè°ƒç”¨çš„å®‰å…¨æ€§ã€å¯æº¯æºæ€§ï¼ˆæŒ‡ä¾¿äºç»Ÿè®¡æ¥å£è°ƒç”¨æ¬¡æ•°ï¼‰ã€‚

### è¯¦ç»†è¯´æ˜

æ€è€ƒä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œå´å¯¹è°ƒç”¨è€…ä¸€æ— æ‰€çŸ¥ã€‚å‡è®¾æˆ‘ä»¬çš„Serveråªèƒ½å…è®¸100ä¸ªäººåŒæ—¶è°ƒç”¨æ¥å£ã€‚å¦‚æœæœ‰æ”»å‡»è€…ç–¯ç‹‚è¯·æ±‚è¿™ä¸ªæ¥å£ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ã€‚ä¸€æ–¹é¢å¯èƒ½ä¼šæŸå®³æˆ‘ä»¬çš„å®‰å…¨æ€§ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯èƒ½è€—å°½Serveræ€§èƒ½ï¼Œå½±å“æ­£å¸¸ç”¨æˆ·ä½¿ç”¨ã€‚

å› æ­¤æˆ‘ä»¬å¿…é¡»ä¸ºæ¥å£è®¾ç½®ä¿æŠ¤æªæ–½ï¼Œä¾‹å¦‚é™åˆ¶æ¯ä¸ªç”¨æˆ·æ¯ç§’åªèƒ½è°ƒç”¨åæ¬¡æ¥å£ï¼Œå³å®æ–½è¯·æ±‚é¢‘æ¬¡çš„é™é¢æ§åˆ¶ã€‚å¦‚æœåœ¨åæœŸï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡æ‰©å¤§ï¼Œå¯èƒ½è¿˜éœ€è¦æ”¶è´¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“è°åœ¨è°ƒç”¨æ¥å£ï¼Œå¹¶ä¸”ä¸èƒ½è®©æ— æƒé™çš„äººéšæ„è°ƒç”¨ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥ç¡®å®šè°åœ¨è°ƒç”¨æ¥å£ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰å¼€å‘åç«¯æ—¶ï¼Œæˆ‘ä»¬ä¼šè¿›è¡Œä¸€äº›æƒé™æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå½“ç®¡ç†å‘˜æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ï¼Œåç«¯éœ€è¦æ£€æŸ¥è¿™ä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•è·å–ç”¨æˆ·ä¿¡æ¯å‘¢ï¼Ÿæ˜¯å¦ç›´æ¥ä»åç«¯çš„ session ä¸­è·å–ï¼Ÿä½†é—®é¢˜æ¥äº†ï¼Œå½“æˆ‘ä»¬è°ƒç”¨æ¥å£æ—¶ï¼Œæˆ‘ä»¬æœ‰ session å—ï¼Ÿæ¯”å¦‚è¯´ï¼Œæˆ‘æ˜¯å‰ç«¯ç›´æ¥å‘èµ·è¯·æ±‚ï¼Œæˆ‘æ²¡æœ‰ç™»å½•æ“ä½œï¼Œæˆ‘æ²¡æœ‰è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæˆ‘æ€ä¹ˆå»è°ƒç”¨å‘¢ï¼Ÿå› æ­¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé‡‡ç”¨ä¸€ä¸ªå«APIç­¾åè®¤è¯çš„æœºåˆ¶ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µã€‚ 

é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯ API ç­¾åè®¤è¯ï¼Ÿç®€å•åœ°è¯´ï¼Œå¦‚æœä½ æƒ³æ¥æˆ‘å®¶åšå®¢ï¼Œæˆ‘ä¸å¯èƒ½éšä¾¿è®©ä»»ä½•é™Œç”Ÿäººè¿›æ¥ã€‚æ‰€ä»¥æˆ‘ä¼šæå‰ç»™ä½ å‘ä¸€ä¸ªç±»ä¼¼äºè¯·å¸–çš„ä¸œè¥¿ï¼Œä½œä¸ºæˆæƒæˆ–è®¸å¯è¯ã€‚å½“ä½ æ¥è®¿é—®æˆ‘çš„æ—¶å€™ï¼Œä½ éœ€è¦å¸¦ä¸Šè¿™ä¸ªè®¸å¯è¯ã€‚æˆ‘å¯èƒ½å¹¶ä¸è®¤è¯†ä½ ï¼Œä½†æˆ‘è®¤è¯†ä½ çš„è¯·å¸–ã€‚åªè¦ä½ æœ‰è¿™ä¸ªè¯·å¸–ï¼Œæˆ‘å°±å…è®¸ä½ è¿›æ¥ã€‚

æ‰€ä»¥ï¼ŒAPIç­¾åè®¤è¯ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªè¿‡ç¨‹ï¼Œç¬¬ä¸€æ˜¯ç­¾å‘ç­¾åï¼Œç¬¬äºŒæ˜¯ä½¿ç”¨ç­¾åå’Œæ ¡éªŒç­¾åã€‚

ä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½è®©ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨æ¥å£ã€‚

å¦‚ä½•åœ¨åç«¯å®ç°ç­¾åè®¤è¯äº†ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªä¸œè¥¿ï¼Œå³accessKeyå’ŒsecretKeyã€‚è¿™è·Ÿç”¨æˆ·åå’Œå¯†ç ç±»ä¼¼ï¼Œä¸è¿‡æ¯æ¬¡è°ƒç”¨æ¥å£éƒ½éœ€è¦å¸¦ä¸Šï¼Œå®ç°æ— çŠ¶æ€çš„è¯·æ±‚ã€‚è¿™æ ·ï¼Œå³ä½¿ä¹‹å‰æ²¡æœ‰æ¥è¿‡ï¼Œè¿™æ¬¡çš„çŠ¶æ€æ­£ç¡®ä¹Ÿå¯ä»¥è°ƒç”¨æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿™ä¸¤ä¸ªä¸œè¥¿æ¥æ ‡è¯†ç”¨æˆ·ã€‚

### API ç­¾åè®¤è¯æ€»ç»“

**æœ¬è´¨ï¼š**

1. ç­¾å‘ç­¾å
2. ä½¿ç”¨ç­¾åï¼ˆæ ¡éªŒç­¾åï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦ï¼š**

1. ä¿è¯å®‰å…¨æ€§ï¼Œä¸èƒ½éšä¾¿è°ƒç”¨
2. é€‚ç”¨äºæ— éœ€ä¿å­˜ç™»é™†æ€çš„åœºæ™¯ï¼Œåªè®¤ç­¾åï¼Œä¸å…³æ³¨ç”¨æˆ·ç™»é™†æ€

#### ç­¾åè®¤è¯å®ç°

é€šè¿‡ Http Request Header ä¼ é€’å‚æ•°

- å‚æ•°1ï¼šaccessKeyï¼Œè°ƒç”¨çš„æ ‡è¯† userA, userBï¼ˆå¤æ‚ã€æ— åºã€æ— è§„å¾‹ï¼‰
- å‚æ•°2ï¼šsecretKeyï¼Œå¯†é’¥ï¼ˆå¤æ‚ã€æ— åºã€æ— è§„å¾‹ï¼‰ï¼Œè¯¥å‚æ•°ä¸èƒ½æ”¾åˆ°è¯·æ±‚å¤´ä¸­

ï¼ˆç±»ä¼¼ç”¨æˆ·åå’Œå¯†ç ï¼ŒåŒºåˆ«ï¼šAKå’ŒSKæ˜¯æ— çŠ¶æ€çš„ï¼‰

- å‚æ•°3ï¼šç”¨æˆ·è¯·æ±‚å‚æ•°
- å‚æ•°4ï¼šsignï¼Œç­¾å

#### åŠ å¯†æ–¹å¼

å¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ã€MD5æ‘˜è¦

ç”¨æˆ·å‚æ•° + å¯†é’¥ => ç­¾åç”Ÿæˆç®—æ³•ï¼ˆMD5, HMac, Sha1ç­‰ï¼‰=> ä¸å¯è§£å¯†çš„å€¼

**æ€ä¹ˆçŸ¥é“ç­¾åæ˜¯å¦æ­£ç¡®ï¼Ÿ**

æœåŠ¡ç«¯ç”¨ä¸€æ‘¸ä¸€æ ·çš„å‚æ•°å’Œç®—æ³•ç”Ÿæˆç­¾åï¼Œåªè¦å’Œç”¨æˆ·ä¼ é€’çš„ä¸€è‡´ï¼Œå°±è¡¨ç¤ºæ­£ç¡®ã€‚

**å¦‚ä½•é˜²æ­¢é‡æ”¾ï¼Ÿ**

- å‚æ•°5ï¼šnonceï¼Œéšæœºæ•°ï¼Œåªèƒ½ç”¨ä¸€æ¬¡ï¼ŒæœåŠ¡ç«¯è¦ä¿å­˜ä½¿ç”¨è¿‡çš„éšæœºæ•°
- å‚æ•°6ï¼štimestampï¼Œæ—¶é—´æˆ³ï¼Œæ ¡éªŒæ—¶é—´æˆ³æ˜¯å¦è¿‡æœŸ

ç¬¬ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡**åŠ å…¥ä¸€ä¸ªéšæœºæ•°å®ç°æ ‡å‡†çš„ç­¾åè®¤è¯**ã€‚æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œå‘é€ä¸€ä¸ªéšæœºæ•°ç»™åç«¯ã€‚åç«¯åªæ¥å—å¹¶è®¤å¯è¯¥éšæœºæ•°ä¸€æ¬¡ï¼Œä¸€æ—¦éšæœºæ•°è¢«ä½¿ç”¨è¿‡ï¼Œåç«¯å°†ä¸å†æ¥å—ç›¸åŒçš„éšæœºæ•°ã€‚è¿™ç§æ–¹å¼è§£å†³äº†è¯·æ±‚é‡æ”¾çš„é—®é¢˜ï¼Œå› ä¸ºå³ä½¿å¯¹æ–¹ä½¿ç”¨ä¹‹å‰çš„æ—¶é—´å’Œéšæœºæ•°è¿›è¡Œè¯·æ±‚ï¼Œåç«¯ä¼šè®¤è¯†åˆ°è¯¥è¯·æ±‚å·²ç»è¢«å¤„ç†è¿‡ï¼Œä¸ä¼šå†æ¬¡å¤„ç†ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•éœ€è¦åç«¯é¢å¤–å¼€å‘æ¥ä¿å­˜å·²ä½¿ç”¨çš„éšæœºæ•°ã€‚å¹¶ä¸”ï¼Œå¦‚æœæ¥å£çš„å¹¶å‘é‡å¾ˆå¤§ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ä¸€ä¸ªéšæœºæ•°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé¢ä¸´å¤„ç†ç™¾ä¸‡ã€åƒä¸‡ç”šè‡³äº¿çº§åˆ«è¯·æ±‚çš„æƒ…å†µã€‚å› æ­¤ï¼Œé™¤äº†ä½¿ç”¨éšæœºæ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…¶ä»–æœºåˆ¶æ¥å®šæœŸæ¸…ç†å·²ä½¿ç”¨çš„éšæœºæ•°ã€‚ 

ç¬¬äºŒç§æ–¹å¼æ˜¯**åŠ å…¥ä¸€ä¸ªæ—¶é—´æˆ³ï¼ˆtimestampï¼‰**ã€‚æ¯ä¸ªè¯·æ±‚åœ¨å‘é€æ—¶æºå¸¦ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå¹¶ä¸”åç«¯ä¼šéªŒè¯è¯¥æ—¶é—´æˆ³æ˜¯å¦åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ï¼Œä¾‹å¦‚ä¸è¶…è¿‡10åˆ†é’Ÿæˆ–5åˆ†é’Ÿã€‚è¿™å¯ä»¥é˜²æ­¢å¯¹æ–¹ä½¿ç”¨æ˜¨å¤©çš„è¯·æ±‚åœ¨ä»Šå¤©è¿›è¡Œé‡æ”¾ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ§åˆ¶éšæœºæ•°çš„è¿‡æœŸæ—¶é—´ã€‚å› ä¸ºåç«¯éœ€è¦åŒæ—¶éªŒè¯è¿™ä¸¤ä¸ªå‚æ•°ï¼Œåªè¦æ—¶é—´æˆ³è¿‡æœŸæˆ–éšæœºæ•°è¢«ä½¿ç”¨è¿‡ï¼Œåç«¯ä¼šæ‹’ç»è¯¥è¯·æ±‚ã€‚å› æ­¤ï¼Œæ—¶é—´æˆ³å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡è½»åç«¯ä¿å­˜éšæœºæ•°çš„è´Ÿæ‹…ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§æ–¹æ³•å¯ä»¥ç›¸äº’é…åˆä½¿ç”¨ã€‚ 

å› æ­¤ï¼Œåœ¨æ ‡å‡†çš„ç­¾åè®¤è¯ç®—æ³•ä¸­ï¼Œå»ºè®®è‡³å°‘æ·»åŠ ä»¥ä¸‹äº”ä¸ªå‚æ•°ï¼šaccessKeyã€secretKeyã€signã€nonceï¼ˆéšæœºæ•°ï¼‰ã€timestampï¼ˆæ—¶é—´æˆ³ï¼‰ã€‚æ­¤å¤–ï¼Œå»ºè®®å°†ç”¨æˆ·è¯·æ±‚çš„å…¶ä»–å‚æ•°ï¼Œä¾‹å¦‚æ¥å£ä¸­çš„ name å‚æ•°ï¼Œä¹Ÿæ·»åŠ åˆ°ç­¾åä¸­ï¼Œä»¥å¢åŠ å®‰å…¨æ€§ã€‚

> APIç­¾åè®¤è¯æ˜¯ä¸€ä¸ªå¾ˆçµæ´»çš„è®¾è®¡ï¼Œå…·ä½“è¦æœ‰å“ªäº›å‚æ•°ã€å‚æ•°åè¦æ ¹æ®å®é™…çš„åœºæ™¯æ¥ï¼ˆæ¯”å¦‚userIdã€appIdã€versionã€å›ºå®šå€¼ç­‰ï¼‰

**ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªKeyï¼Ÿ**

å¦‚æœä»…å‡­ä¸€ä¸ªKeyå°±å¯ä»¥è°ƒç”¨æ¥å£ï¼Œé‚£ä¹ˆä»»ä½•æ‹¿åˆ°è¿™ä¸ªKeyçš„äººéƒ½å¯ä»¥æ— é™åˆ¶çš„è°ƒç”¨è¿™ä¸ªæ¥å£ã€‚è¿™å°±å¥½æ¯”ï¼Œä¸ºä»€ä¹ˆä½ åœ¨ç™»å½•ç½‘ç«™çš„æ—¶å€™éœ€è¦è¾“å…¥å¯†ç ï¼Œè€Œä¸æ˜¯ä»…ä»…è¾“å…¥ç”¨æˆ·åå°±å¯ä»¥äº†ï¼Ÿè¿™äºŒè€…çš„åŸç†æ˜¯ä¸€æ ·çš„ã€‚

**å®‰å…¨ä¼ é€’æ€§**

å¯†é’¥ä¸€å®šä¸èƒ½ä¼ é€’ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å‘å¯¹æ–¹å‘é€è¯·æ±‚æ—¶ï¼Œå¯†é’¥ç»å¯¹ä¸èƒ½ä»¥æ˜æ–‡çš„å½¢å¼ä¼ é€’ï¼Œå¿…é¡»é€šè¿‡ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œä¼ é€’ã€‚åœ¨æ ‡å‡†çš„APIç­¾åè®¤è¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªç­¾åï¼Œè¿™ä¸ªç­¾åæ˜¯æ ¹æ®å¯†é’¥ç”Ÿæˆçš„ã€‚



## SDK

### ä¸ºä»€ä¹ˆéœ€è¦Starterï¼Ÿ

ç†æƒ³æƒ…å†µï¼šå¼€å‘è€…åªéœ€è¦å…³å¿ƒè°ƒç”¨é‚£äº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ï¼Œå°±è·Ÿè°ƒç”¨è‡ªå·±å†™çš„ä»£ç ä¸€æ ·ç®€å•ã€‚

å¼€å‘Starterçš„å¥½å¤„ï¼šå¼€å‘è€…å¼•å…¥Starterä¹‹åï¼Œå¯ä»¥ç›´æ¥åœ¨`application.yml`ä¸­å†™é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå®¢æˆ·ç«¯ã€‚

**è¿›ä¸€æ­¥è¯´æ˜**

ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…çš„è°ƒç”¨ï¼Œæˆ‘ä»¬ä¸èƒ½è®©ä»–ä»¬æ¯æ¬¡éƒ½è‡ªå·±ç¼–å†™ç­¾åç®—æ³•ï¼Œè¿™æ˜¾ç„¶å¾ˆç¹çã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¼€å‘ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ SDKï¼Œä½¿å¼€å‘è€…åªéœ€å…³æ³¨è°ƒç”¨å“ªäº›æ¥å£ã€ä¼ é€’å“ªäº›å‚æ•°ï¼Œå°±åƒè°ƒç”¨è‡ªå·±ç¼–å†™çš„ä»£ç ä¸€æ ·ç®€å•ã€‚å®é™…ä¸Šï¼ŒRPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰å°±æ˜¯ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„è€Œè®¾è®¡çš„ã€‚RPCå®ƒå°±æ˜¯è¿½æ±‚ç®€å•åŒ–è°ƒç”¨çš„ç†æƒ³æƒ…å†µã€‚ç±»ä¼¼çš„ä¾‹å­æ˜¯å°ç¨‹åºå¼€å‘æˆ–è€…è°ƒç”¨ç¬¬ä¸‰æ–¹ APIï¼Œå¦‚è…¾è®¯äº‘çš„ APIï¼Œå®ƒä»¬éƒ½æä¾›äº†ç›¸åº”çš„ SDKã€‚



### å¦‚ä½•å¼€å‘Starterï¼Ÿ

- ç¡®è®¤æ‰€éœ€è¦çš„ä¾èµ–ï¼Œéœ€è¦å¼•å…¥`spring-boot-configuration-processor`ï¼ˆé…ç½®æ–‡ä»¶ç¼–å†™æç¤ºï¼‰
- è¿‡ç¨‹ä»£ç ç¼–å†™
- é…ç½®ç±»ç¼–å†™
- åœ¨`resources`ç›®å½•ä¸‹åˆ›å»º`META-INF/spring.factories`ï¼Œå…¶ä¸­é…ç½®è‡ªåŠ¨é…ç½®ç±»`org.springframework.boot.autoconfigure.EnableAutoConfiguration=xxx`

```java
@Data
@Configuration
@ConfigurationProperties("juzi.api.client")
@ComponentScan
public class MockApiConfig {
    private String accessKey;
    private String secretKey;

    @Bean
    public MockApiClient mockApiClient() {
        return new MockApiClient(accessKey, secretKey);
    }
}
```

```spring.factories
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
  com.juzi.sdk.config.MockApiConfig
```

> æ˜ç¡®ä¸€ä¸ª**æ ¸å¿ƒç‚¹**ï¼šä¸€æ—¦æ¥å£æŠ•å…¥ä½¿ç”¨åï¼Œè‚¯å®šè¦é’ˆå¯¹è¿™ä¸ªæ¥å£è¿›è¡Œ SDK çš„å¼€å‘ã€‚ä½ éœ€è¦ä¸æ–­åœ°å®Œå–„ SDKï¼Œä½¿å…¶é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è®© SDK ä»æ¥å£ä¿¡æ¯è¡¨ä¸­è¯»å–ä¿¡æ¯ï¼Œç„¶ååŠ¨æ€ç”Ÿæˆæ–¹æ³•ç­‰ç­‰ï¼Œè¿™ç§åšæ³•ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œç„¶è€Œï¼Œå¹¶ä¸å»ºè®®è¿™æ ·åšã€‚å®é™…ä¸Šï¼Œæ¥å£çš„å‘å¸ƒå¯èƒ½ä¸å¤ªåƒæˆ‘ä»¬åœ¨åº”ç”¨å•†åº—å‘å¸ƒåº”ç”¨é‚£æ ·çµæ´»ï¼Œåœ¨è¿™ç§æ¥å£çš„å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œå»ºè®®è¿˜æ˜¯ä»‹å…¥ä¸€ç‚¹äººå·¥ã€‚
>
> æ¯æ¬¡å‘å¸ƒä¸€ä¸ªæ–°çš„æ¥å£ï¼Œéƒ½éœ€è¦å¯¹ SDK è¿›è¡Œæ›´æ–°ã€‚å»ºè®®çš„åšæ³•æ˜¯è¿™æ ·çš„ï¼šç”±äºç”¨æˆ·å¹¶ä¸å…³å¿ƒå…·ä½“çš„æ¥å£åœ°å€ï¼Œå› æ­¤ä½ å¯ä»¥è®©ä»–ä»¬ç›´æ¥è°ƒç”¨æ–¹æ³•åï¼Œç„¶åæ ¹æ®è¿™äº›æ–¹æ³•åå»åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„æ–¹æ³•ã€‚æ¯æ¬¡å‘å¸ƒæ–°æ¥å£æ—¶ï¼Œæ›´æ–° SDK çš„æ“ä½œå¯ä»¥åšå¾—éå¸¸ç®€å•ï¼Œå¯ä»¥é‡‡ç”¨è„šæœ¬çš„æ–¹å¼ï¼Œä»æ•°æ®åº“ä¸­è¯»å–æ¥å£åœ°å€ï¼Œä¸ä¹‹å‰å·²æœ‰çš„åœ°å€è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åè¡¥å……ç›¸åº”çš„æ–¹æ³•ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¯è¡Œçš„ï¼Œäº‹å®ä¸Šï¼Œå¾ˆå¤šå…¬å¸éƒ½åœ¨è¿™æ ·åšã€‚

## RPC

é—®é¢˜ï¼šç½‘å…³é¡¹ç›®æ¯”è¾ƒçº¯å‡€ï¼Œæ²¡æœ‰æ“ä½œæ•°æ®åº“çš„åŒ…ï¼Œå¹¶ä¸”è¿˜è¦è°ƒç”¨ä¹‹å‰å†™è¿‡çš„ä»£ç ï¼Œå¤åˆ¶ç²˜è´´æ¯”è¾ƒéº»çƒ¦

ç†æƒ³ï¼šç›´æ¥è¯·æ±‚é“å…¶ä»–é¡¹ç›®çš„æ–¹æ³•

**æ€ä¹ˆè°ƒç”¨å…¶ä»–é¡¹ç›®çš„æ–¹æ³•ï¼Ÿ**

- å¤åˆ¶ä»£ç å’Œä¾èµ–ã€ç¯å¢ƒ
- HTTPè¯·æ±‚ï¼ˆæä¾›ä¸€ä¸ªæ¥å£ï¼Œä¾›å…¶ä»–é¡¹ç›®è°ƒç”¨ï¼‰
- RPC
- æŠŠå…¬å…±çš„ä»£ç æ‰“æˆJaråŒ…ï¼Œå…¶ä»–é¡¹ç›®å»åº”ç”¨ï¼ˆå®¢æˆ·ç«¯SDKï¼‰

**RPC**

ä½œç”¨ï¼šåƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•

å’Œç›´æ¥HTTPè°ƒç”¨çš„åŒºåˆ«ï¼š

- å¯¹å¼€å‘è€…æ›´é€æ˜ï¼Œå‡å°‘äº†å¾ˆå¤šæ²Ÿé€šæˆæœ¬
- RPCå‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œæœªå¿…éœ€è¦ä½¿ç”¨HTTPåè®®ï¼Œæ¯”å¦‚è¿˜å¯ä»¥ä½¿ç”¨TCP / IPåè®®ï¼Œæ€§èƒ½æ›´é«˜ï¼ˆå†…éƒ¨æœåŠ¡æ›´é€‚ç”¨ï¼‰

**è¿›ä¸€æ­¥è¯´æ˜**ï¼š

RPC å’Œ HTTP è¯·æ±‚åœ¨æœ¬è´¨ä¸Šæœ‰ä¸€äº›åŒºåˆ«ã€‚RPC ç›¸å¯¹äº HTTP è¯·æ±‚æ›´åŠ é€æ˜ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨å¼€å‘è€…é—´æ›´å…·é€æ˜åº¦ã€‚è¿™ç§é€æ˜æ€§æ˜¯å¦‚ä½•ç†è§£çš„å‘¢ï¼Ÿä¸€ä¸ªå¹¿æ³›çš„å®šä¹‰æ˜¯ï¼ŒRPC çš„ç›®æ ‡æ˜¯ä½¿è¿œç¨‹æ–¹æ³•çš„è°ƒç”¨å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·ï¼Œä»è€Œå®ç°æ›´ä¸ºä¾¿æ·çš„è¿œç¨‹é€šä¿¡ã€‚ 

ä»¥ HTTP è¯·æ±‚ä¸ºä¾‹ï¼Œè°ƒç”¨æ–¹éœ€è¦å®Œæˆè¯¸å¤šæ­¥éª¤ã€‚é¦–å…ˆï¼Œå®ƒéœ€è¦å‘é€ HTTP è¯·æ±‚ï¼Œä½¿ç”¨ä¸€ä¸ª HTTP å®¢æˆ·ç«¯çš„ä»£ç åº“ã€‚ä»¥æˆ‘ä»¬çš„sdké¡¹ç›®ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¢æˆ·ç«¯å¯¹è±¡æ˜¯å¦‚ä½•ä½¿ç”¨ HTTPUtil è¿™ä¸ª hutool å·¥å…·ç±»çš„åŒ…æ¥å‘é€è¯·æ±‚çš„ï¼Œè¿™æ„å‘³ç€è°ƒç”¨æ–¹éœ€è¦ç¼–å†™ç‰¹å®šçš„ä»£ç æ®µæ¥å‘é€è¯·æ±‚ï¼Œç„¶åå¤„ç†è¿”å›å€¼ï¼Œå¯èƒ½è¿˜éœ€è¦è§£æè¿”å›å€¼å¹¶å°è£…å‚æ•°çš„æ˜ å°„å…³ç³»ç­‰ã€‚

å¦‚æœæˆ‘ä»¬ä½¿ç”¨ RPC æ–¹å¼ï¼Œå°±èƒ½å¤Ÿå®ç°ä¸è°ƒç”¨æœ¬åœ°æ–¹æ³•ç±»ä¼¼çš„ä½“éªŒã€‚ä½ å¯ä»¥ç›´æ¥æŒ‡å®šè¦ä¼ é€’çš„å‚æ•°ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤Ÿç›´æ¥è·å¾—è¿”å›å€¼ï¼Œæ— è®ºæ˜¯å¸ƒå°”ç±»å‹è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚RPC æ–¹å¼ä¸éœ€è¦åƒ HTTP è¯·æ±‚é‚£æ ·è¿›è¡Œé¢å¤–çš„å°è£…ï¼Œä½†å¦‚æœä½ éœ€è¦å°è£…ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ ¹æ®éœ€æ±‚è‡ªè¡Œå¤„ç†ã€‚

> **feign ä¸ä¹Ÿæ˜¯åŠ¨æ€ç”Ÿæˆçš„ httpclient å—ï¼Ÿ** 
>
> Feign æœ¬è´¨ä¸Šä¹Ÿæ˜¯åŠ¨æ€ç”Ÿæˆçš„ HTTP å®¢æˆ·ç«¯ï¼Œä½†å®ƒåœ¨è°ƒç”¨è¿œç¨‹æ–¹æ³•æ—¶æ›´åŠ ç²¾ç®€äº† HTTP è¯·æ±‚çš„æ­¥éª¤ã€‚å°½ç®¡ Feign ä½¿è¿œç¨‹è°ƒç”¨çœ‹èµ·æ¥åƒæ˜¯è°ƒç”¨æœ¬åœ°æ–¹æ³•ï¼Œä½†å®é™…ä¸Šä¸ RPC ä»ç„¶æœ‰ä¸€äº›å¾®å°çš„åŒºåˆ«ã€‚è™½ç„¶ä¸¤è€…éƒ½å¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬åœ¨åº•å±‚åè®®ä¸Šå­˜åœ¨å·®å¼‚ã€‚ 
>
> RPC(Remote Procedure Call è¿œç¨‹è¿‡ç¨‹è°ƒç”¨) çš„ä¸€ä¸ªå…³é”®ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå¯ä»¥ä½¿ç”¨å¤šç§åº•å±‚åè®®è¿›è¡Œè¿œç¨‹è°ƒç”¨ï¼Œè€Œä¸é™äº HTTP åè®®ã€‚è™½ç„¶ HTTP åè®®å¯ä»¥å®ç°ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†è€ƒè™‘åˆ°æ€§èƒ½ï¼ŒRPC å¯ä»¥é€‰æ‹©æ›´åŸç”Ÿçš„åè®®ï¼Œå¦‚ TCP/IPã€‚è€Œä¸”ï¼Œç½‘ç»œä¸Šè¿˜å­˜åœ¨å…¶ä»–æ€§èƒ½æ›´é«˜çš„åè®®ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé€‰æ‹©ã€‚ åœ¨å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œå¯¹äºå†…éƒ¨æ¥å£ï¼Œä½¿ç”¨ RPC å¯èƒ½ä¼šè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚ç„¶è€Œï¼Œé€‰æ‹©ä½¿ç”¨ Feign è¿˜æ˜¯ RPC å–å†³äºå…·ä½“çš„æŠ€æœ¯éœ€æ±‚ï¼Œæ²¡æœ‰ç»å¯¹çš„ä¼˜åŠ£ä¹‹åˆ†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRPC å’Œ HTTP è¯·æ±‚å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œå› ä¸º RPC çš„åº•å±‚åè®®å¯ä»¥æ˜¯ HTTPï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–åè®®ï¼Œå¦‚ TCP/IP æˆ–è‡ªå®šä¹‰åè®®ã€‚ 
>
> ç»¼ä¸Šæ‰€è¿°ï¼ŒRPC å’Œ HTTP è¯·æ±‚æ˜¯å¯ä»¥äº’ç›¸ç»“åˆçš„ï¼Œä½† RPC åœ¨åè®®çš„é€‰æ‹©ä¸Šæ›´åŠ çµæ´»ã€‚





## é™æµ

> ä¸ºäº†ä¿è¯æ¥å£è°ƒç”¨çš„æ€§èƒ½ã€ç¨³å®šæ€§å’Œå¯ç”¨æ€§ï¼Œåœ¨ç½‘å…³å±‚é¢é€šè¿‡Redissonçš„RateLimiterå®ç°é™æµä¿æŠ¤ï¼ˆ1sæœ€å¤šè¯·æ±‚1æ¬¡ï¼‰

æˆ‘ä»¬éœ€è¦æ§åˆ¶ç”¨æˆ·ä½¿ç”¨ç³»ç»Ÿçš„æ¬¡æ•°ï¼Œä»¥é¿å…è¶…æ”¯ã€‚ä½†æ˜¯é™åˆ¶ç”¨æˆ·è°ƒç”¨æ¬¡æ•°ä»å­˜åœ¨ä¸€å®šé£é™©ï¼Œç”¨æˆ·ä»æœ‰å¯èƒ½ç–¯ç‹‚è°ƒç”¨æ¥åˆ·é‡ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿæˆæœ¬è¿‡åº¦æ¶ˆè€—ã€‚

é™æµï¼ˆæµé‡æ§åˆ¶ï¼‰ï¼šæŒ‡ç³»ç»Ÿåœ¨é¢ä¸´é«˜å¹¶å‘ï¼Œæˆ–è€…**å¤§æµé‡è¯·æ±‚**çš„æƒ…å†µä¸‹ï¼Œ**é™åˆ¶æ–°çš„è¯·æ±‚å¯¹ç³»ç»Ÿçš„è®¿é—®**ï¼Œä»è€Œ**ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§**ã€‚é™æµä¼šå¯¼è‡´éƒ¨åˆ†ç”¨æˆ·è¯·æ±‚å¤„ç†ä¸åŠæ—¶æˆ–è€…è¢«æ‹’ç»ï¼Œå½±å“äº†ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦åœ¨ç³»ç»Ÿç¨³å®šå’Œç”¨æˆ·ä½“éªŒä¹‹é—´é€‰æ‹©å¹³è¡¡ã€‚

**é—®é¢˜**ï¼šä½¿ç”¨ç³»ç»Ÿæ˜¯éœ€è¦æ¶ˆè€—æˆæœ¬çš„ï¼Œç”¨æˆ·æœ‰å¯èƒ½ç–¯ç‹‚åˆ·é‡

**è§£å†³æ–¹æ¡ˆ**ï¼š

1. æ§åˆ¶æˆæœ¬ => é™åˆ¶ç”¨æˆ·è°ƒç”¨æ¬¡æ•°
2. ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…ç–¯ç‹‚ä½¿ç”¨ï¼Œå¯¼è‡´æœåŠ¡å™¨èµ„æºè¢«å æ»¡ï¼Œå…¶ä»–ç”¨æˆ·æ— æ³•ä½¿ç”¨ => é™æµ

### å¸¸è§çš„é™æµç®—æ³•

#### å›ºå®šçª—å£é™æµç®—æ³•

é¦–å…ˆç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå°†å•ä½æ—¶é—´æ®µå½“åšä¸€ä¸ªçª—å£ï¼Œè®¡æ•°å™¨è®°å½•è¿™ä¸ªçª—å£æ¥æ”¶è¯·æ±‚çš„æ¬¡æ•°

- å½“æ¬¡æ•°å°äºé™æµé˜ˆå€¼ï¼Œå°±å…è®¸è®¿é—®ï¼Œå¹¶ä¸”è®¡æ•°å™¨+1
- å½“æ¬¡æ•°å¤§äºé™æµé˜ˆå€¼ï¼Œå°±æ‹’ç»è®¿é—®
- å½“å‰çš„æ—¶é—´çª—å£è¿‡å»ä¹‹åï¼Œè®¡æ•°å™¨æ¸…é›¶

ã€æ —å­ğŸŒ°ã€‘å‡è®¾å•ä½æ—¶é—´æ˜¯1ç§’ï¼Œé™æµé˜ˆå€¼æ˜¯3ã€‚åœ¨å•ä½æ—¶é—´1så†…ï¼Œæ¯æ¬¡æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œè®¡æ•°å™¨å°±+1ï¼Œå¦‚æœè®¡æ•°å™¨ç´¯åŠ çš„æ¬¡æ•°è¶…è¿‡äº†é™æµé˜ˆå€¼3ï¼Œåç»­åœ¨1så†…çš„è¯·æ±‚å…¨éƒ¨æ‹’ç»ã€‚ç­‰åˆ°1sç»“æŸåï¼Œè®¡æ•°å™¨æ¸…é›¶ï¼Œé‡æ–°å¼€å§‹è®¡æ•°ã€‚

![å›ºå®šæ—¶é—´çª—å£é™æµç®—æ³•ç¤ºæ„å›¾](assets/å›ºå®šæ—¶é—´çª—å£é™æµç®—æ³•ç¤ºæ„å›¾.png)

```java
/**
  * å›ºå®šæ—¶é—´çª—å£é™æµç®—æ³•ï¼ˆä¼ªä»£ç ï¼‰
  * 
  * @return true - è¯·æ±‚åœ¨é˜ˆå€¼å†…ï¼Œæ­£å¸¸å“åº”
  */
boolean fixedWindowsTryAcquire() {
  // è·å–å½“å‰ç³»ç»Ÿçš„æ—¶é—´
  long currentTime = System.currentTimeMillis();
  // æ£€æŸ¥æ˜¯å¦åœ¨æ—¶é—´çª—å£å†…
  if (currentTime - lastReqTime > windowUnit) {
    // ä¸åœ¨æ—¶é—´çª—å£å†…ï¼Œè®¡æ•°å™¨æ¸…é›¶
    counter = 0;
    // å¼€å¯æ–°çš„æ—¶é—´çª—å£
    lastReqTime = currentTime;
  }
  // åˆ¤æ–­è®¡æ•°å™¨æ˜¯å¦å°äºé˜ˆå€¼
  if (counter < threshold) {
    // å°äºé˜ˆå€¼ï¼Œè®¡æ•°å™¨ + 1ï¼Œæ­£å¸¸å“åº”è¯·æ±‚
    counter++;
    return true;
  }
  // è¶…è¿‡é˜ˆå€¼ï¼Œæ‹’ç»å“åº”
  return false;
}
```

**é—®é¢˜ï¼š**

è¿™ç§ç®—æ³•å­˜åœ¨ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„**ä¸´ç•Œé—®é¢˜**ï¼šå‡è®¾é™æµé˜ˆå€¼ä¸º5ä¸ªè¯·æ±‚ï¼Œå•ä½æ—¶é—´çª—å£æ˜¯1sï¼Œè‹¥æˆ‘ä»¬åœ¨å•ä½æ—¶é—´å†…çš„å‰[0.8, 1)å’Œ[1, 1.2)æ—¶é—´æ®µå†…ï¼Œåˆ†åˆ«å‘é€5ä¸ªè¯·æ±‚ï¼Œè™½ç„¶éƒ½æ²¡æœ‰è¶…è¿‡é˜ˆå€¼ï¼Œä½†æ˜¯å¦‚æœç®—è¿™[0.8, 1.2)æ—¶é—´æ®µå†…ï¼Œå¹¶å‘æ•°é«˜è¾¾10ï¼Œ**è¶…è¿‡äº†å•ä½æ—¶é—´1sä¸è¶…è¿‡5é˜ˆå€¼**çš„å®šä¹‰ã€‚

![å›ºå®šæ—¶é—´çª—å£é™æµç®—æ³•ä¸´ç•Œé—®é¢˜](assets/å›ºå®šæ—¶é—´çª—å£é™æµç®—æ³•ä¸´ç•Œé—®é¢˜.png)

### æ»‘åŠ¨çª—å£é™æµç®—æ³•

æ»‘åŠ¨çª—å£é™æµè§£å†³äº†å›ºå®šçª—å£é™æµä¸´ç•Œé—®é¢˜ã€‚å®ƒå°†å•ä½æ—¶é—´å‘¨æœŸåˆ†æˆnä¸ªå°å‘¨æœŸï¼Œåˆ†åˆ«è®°å½•æ¯ä¸ªå°å‘¨æœŸå†…æ¥å£çš„è®¿é—®æ¬¡æ•°ï¼Œå¹¶ä¸”æ ¹æ®æ—¶é—´æ»‘åŠ¨åˆ é™¤è¿‡æœŸçš„å°å‘¨æœŸã€‚

![æ»‘åŠ¨çª—å£é™æµç®—æ³•ç¤ºæ„å›¾](assets/æ»‘åŠ¨çª—å£é™æµç®—æ³•ç¤ºæ„å›¾.png)

å‡è®¾å•ä½æ—¶é—´è¿˜æ˜¯1sï¼Œæ»‘åŠ¨çª—å£ç®—æ³•æŠŠå®ƒåˆ’åˆ†æˆ5ä¸ªå°å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯æ»‘åŠ¨çª—å£ï¼ˆå•ä½æ—¶é—´ï¼‰è¢«åˆ’åˆ†ä¸º5ä¸ªå°åŒºé—´ã€‚æ¯ä¸ªåŒºé—´ä»£è¡¨0.2sã€‚æ¯è¿‡0.2sï¼Œæ—¶é—´çª—å£å°±ä¼šå¾€å³æ»‘åŠ¨ä¸€æ ¼ã€‚æ¯ä¸ªå°å‘¨æœŸéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è®¡æ•°å™¨ï¼Œå‡è®¾è¯·æ±‚æ˜¯åœ¨0.85såˆ°è¾¾çš„ï¼Œ[0.8, 1.0)å¯¹åº”çš„è®¡æ•°å™¨+1ã€‚

æ»‘åŠ¨çª—å£æ˜¯å¦‚ä½•è§£å†³å›ºå®šçª—å£ä¸´ç•Œé—®é¢˜çš„å‘¢ï¼Ÿ

å‡è®¾1så†…çš„é™æµé˜ˆå€¼è¿˜æ˜¯5ï¼Œ[0.8, 1.0)å†…æ¥äº†5ä¸ªè¯·æ±‚ï¼Œè½åœ¨é»„è‰²æ ¼å­å†…ï¼Œæ—¶é—´ç‚¹è¿‡äº†1.0sç‚¹ä¹‹åï¼Œåˆæ¥äº†5ä¸ªè¯·æ±‚ï¼Œè½åœ¨äº†è™¹è‰²æ ¼å­å†…ã€‚å¦‚æœæ˜¯**å›ºå®šçª—å£ç®—æ³•ï¼Œæ˜¯ä¸ä¼šè§¦å‘é™æµçš„**ï¼Œä½†æ˜¯**æ»‘åŠ¨çª—å£æ¯è¿‡ä¸€ä¸ªå°å‘¨æœŸï¼Œå®ƒä¼šå³ç§»ä¸€å°æ ¼**ã€‚è¿‡äº†1.0sè¿™ä¸ªç‚¹åï¼Œå³ç§»ä¸€å°æ ¼ï¼Œä¹Ÿå°±æ˜¯å½“å‰çš„å•ä½æ—¶é—´æ®µä¸º[0.2, 1.2)ï¼Œè¿™ä¸ªæ—¶é—´æ®µå†…çš„è¯·æ±‚å·²ç»è¶…è¿‡é˜ˆå€¼é™å®š5äº†ï¼Œè§¦å‘äº†é™æµã€‚å®é™…ä¸Šï¼Œçº¢è‰²æ ¼å­çš„è¯·æ±‚éƒ½ä¼šè¢«æ‹’ç»ã€‚

> å½“æ»‘åŠ¨çª—å£çš„æ ¼å­å‘¨æœŸåˆ’åˆ†çš„è¶Šå¤šï¼Œæ»‘åŠ¨çª—å£çš„æ»šåŠ¨è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚

```java
/**
  * å•ä½æ—¶é—´åˆ’åˆ†çš„å°å‘¨æœŸç§’æ•°ï¼ˆå•ä½æ—¶é—´æ˜¯1åˆ†é’Ÿï¼Œ10sä¸€ä¸ªå°æ ¼å­çª—å£ï¼Œä¸€å…±6ä¸ªæ ¼å­ï¼‰
  */
private int SUB_CYCLE = 10;

/**
  * æ¯åˆ†é’Ÿé™æµé˜ˆå€¼
  */
private int perMinThreshold = 100;

/**
  * è®¡æ•°å™¨ {å½“å‰çª—å£çš„å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰: å½“å‰çª—å£çš„è®¡æ•°å€¼}
  */
private final TreeMap<Long, Integer> COUNTER = new TreeMap<>();

/**
  * æ»‘åŠ¨çª—å£æ—¶é—´ç®—æ³•å®ç°ï¼ˆä¼ªä»£ç ï¼‰
  * 
  * @return true - è¯·æ±‚åœ¨é˜ˆå€¼å†…ï¼Œæ­£å¸¸å“åº”
  */
boolean slidingWindowsTryAcquire() {
  // è·å–å½“å‰æ—¶é—´åœ¨å“ªä¸ªå°å‘¨æœŸçª—å£
  long currentWindowTime = LocalDateTime.now().toEpochSecond(ZoneOffset.UTC) / SUB_CYCLE * SUB_CYCLE;
  int currWindowCount = countCurrWindow(currentWindowTime);

  // åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼
  if (currWindowCount > perMinThreshold) {
    return false;
  }

  // è®¡æ•°å™¨ + 1
  COUNTER.put(currentWindowTime,
              (Objects.isNull(COUNTER.get(currentWindowTime)) ? 0 : CUNTER.get(currentWindowTime)) + 1);
  return true;
}

/**
  * ç»Ÿè®¡å½“å‰çª—å£çš„è®¡æ•°å€¼
  */
private int countCurrWindow(long currentWindowTime) {
  // è®¡ç®—çª—å£å¼€å§‹ä½ç½®
  long startTime = currentWindowTime - SUB_CYCLE * (60 / SUB_CYCLE - 1);
  int count = 0;

  Iterator<Map.Entry<Long, Integer>> iterator = COUNTER.entrySet().iterator();
  while (iterator.hasNext()) {
    Map.Entry<Long, Integer> entry = iterator.next();
    // åˆ é™¤æ— æ•ˆè¿‡æœŸçš„å­çª—å£è®¡æ•°å™¨
    if (entry.getKey() < startTime) {
      iterator.remove();
    } else {
      // ç´¯åŠ å½“å‰çª—å£çš„æ‰€æœ‰è®¡æ•°å™¨ä¹‹å’Œ
      count += entry.getValue();
    }
  }
  return count;
}
```

æ»‘åŠ¨çª—å£é™æµç®—æ³•è™½ç„¶è§£å†³äº†**å›ºå®šçª—å£çš„ä¸´ç•Œé—®é¢˜**ï¼Œä½†æ˜¯ä¸€æ—¦åˆ°è¾¾é™æµåï¼Œè¯·æ±‚éƒ½ä¼šç›´æ¥æš´åŠ›è¢«æ‹’ç»ï¼Œè¿™æ ·å­æˆ‘ä»¬ä¼šæŸå¤±ä¸€éƒ¨åˆ†è¯·æ±‚ï¼Œè¿™å¯¹äºäº§å“æ¥è¯´ï¼Œä¸å¤ªå‹å¥½ã€‚

### æ¼æ¡¶ç®—æ³•

æ¼æ¡¶ç®—æ³•é¢å¯¹é™æµï¼Œæ›´åŠ å…·æœ‰æŸ”æ€§ï¼Œä¸å­˜åœ¨ç›´æ¥çš„æš´åŠ›æ‹’ç»ã€‚

åŸç†ï¼šå°±æ˜¯**æ³¨æ°´æ¼æ°´**çš„è¿‡ç¨‹ã€‚å¾€æ¼æ¡¶ä¸­ä»¥ä»»æ„é€Ÿç‡æ³¨æ°´ï¼Œä»¥å›ºå®šçš„é€Ÿç‡æ¼æ°´ã€‚å½“æ°´è¶…è¿‡æ¡¶çš„å®¹é‡æ—¶ï¼Œå°±ä¼šæº¢å‡ºï¼Œä¹Ÿå°±æ˜¯è¢«ä¸¢å¼ƒã€‚å› ä¸ºæ¡¶çš„å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚

![æ¼æ¡¶é™æµç®—æ³•ç¤ºæ„å›¾](assets/æ¼æ¡¶é™æµç®—æ³•ç¤ºæ„å›¾.png)

å‡ ç‚¹è¯´æ˜ï¼š

1. æµå…¥çš„æ°´ï¼Œå¯ä»¥çœ‹åšæ˜¯è®¿é—®ç³»ç»Ÿçš„è¯·æ±‚ï¼Œè¿™ä¸ªæµå…¥é€Ÿç‡æ˜¯ä¸ç¡®å®šçš„
2. æ¡¶çš„å®¹é‡ä¸€èˆ¬è¡¨ç¤ºç³»ç»Ÿæ‰€èƒ½å¤„ç†çš„è¯·æ±‚æ•°
3. å¦‚æœæ¡¶çš„å®¹é‡æ»¡äº†ï¼Œå°±æ˜¯è¾¾åˆ°é™æµçš„é˜ˆå€¼ï¼Œä¸¢å¼ƒæ°´ï¼ˆæ‹’ç»è¯·æ±‚ï¼‰
4. æ°´æµå‡ºçš„é€Ÿç‡æ˜¯æ’å®šçš„ï¼Œå¯¹åº”ç³»ç»ŸæŒ‰ç…§å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚

```java
/**
  * æ¯ç§’å¤„ç†è¯·æ±‚æ•°ï¼ˆå‡ºæ°´ç‡ï¼‰
  */
private long rate;

/**
  * å½“å‰å‰©ä½™æ°´é‡
  */
private long currentWater;

/**
  * æœ€ååˆ·æ–°æ—¶é—´
  */
private long refreshTime;

/**
  * æ¡¶å®¹é‡
  */
private long capacity;

/**
  * æ¼æ¡¶ç®—æ³•ï¼ˆä¼ªä»£ç ï¼‰
  * 
  * @return true - è¯·æ±‚åœ¨é˜ˆå€¼å†…ï¼Œæ­£å¸¸å“åº”
  */
boolean leakyBucketLimitTryAcquire() {
  // è·å–å½“å‰æ—¶é—´
  long currentTime = System.currentTimeMillis();
  // æµå‡ºçš„æ°´é‡ = ï¼ˆå½“å‰æ—¶é—´ - ä¸Šæ¬¡åˆ·æ–°æ—¶é—´ï¼‰* å‡ºæ°´ç‡ 
  long outWater = (currentTime - refreshTime) / 1000 * rate;
  // å½“å‰æ°´é‡ = ä¹‹å‰æ¡¶å†…æ°´é‡ - æµå‡ºçš„æ°´é‡
  long currentWater = Math.max(0, currentWater - outWater);
  // åˆ·æ–°æ—¶é—´
  refreshTime = currentTime;
  // åˆ¤æ–­å‰©ä½™æ°´é‡æ˜¯å¦å°äºæ¡¶çš„å®¹é‡
  if (currentWater < capacity) {
    // å°äºï¼Œè¯·æ±‚æ”¾è¡Œ
    currentWater++;
    return true;
  }

  // æº¢å‡ºï¼Œé™æµ
  return false;
}
```

åœ¨æ­£å¸¸æµé‡çš„æ—¶å€™ï¼Œç³»ç»ŸæŒ‰ç…§æˆ‘ä»¬å›ºå®šçš„é€Ÿç‡å¤„ç†è¯·æ±‚ï¼Œè¿™æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ä½†æ˜¯**é¢å¯¹çªå‘æµé‡**çš„æ—¶å€™ï¼Œæ¼æ¡¶ç®—æ³•è¿˜æ˜¯åœ¨å¾ªè§„è¹ˆçŸ©çš„å¤„ç†è¯·æ±‚ï¼Œè¿™å°±ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

### ä»¤ç‰Œæ¡¶ç®—æ³•

é¢å¯¹**çªå‘æµé‡**æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•é™æµã€‚

**ç®—æ³•åŸç†**ï¼š

1. æœ‰ä¸€ä¸ªä»¤ç‰Œç®¡ç†å‘˜ï¼Œæ ¹æ®é™æµå¤§å°ï¼Œå®šé€Ÿåƒä»¤ç‰Œæ¡¶ä¸­æ”¾å…¥ä»¤ç‰Œ
2. å¦‚æœä»¤ç‰Œæ•°é‡æ»¡äº†ï¼Œè¶…è¿‡ä»¤ç‰Œæ¡¶å®¹é‡çš„é™åˆ¶ï¼Œé‚£å°±ä¸¢å¼ƒ
3. ç³»ç»Ÿåœ¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šå…ˆå»å‘ä»¤ç‰Œæ¡¶è¦ä¸€ä¸ªä»¤ç‰Œã€‚å¦‚æœæ‹¿åˆ°ä»¤ç‰Œï¼Œé‚£ä¹ˆå°±å¤„ç†è¿™ä¸ªè¯·æ±‚
4. å¦‚æœæ‹¿ä¸åˆ°ä»¤ç‰Œï¼Œæ‹’ç»è¿™ä¸ªè¯·æ±‚

![ä»¤ç‰Œæ¡¶é™æµç®—æ³•ç¤ºæ„å›¾](assets/ä»¤ç‰Œæ¡¶é™æµç®—æ³•ç¤ºæ„å›¾.png)

```java
/**
  * æ¯ç§’å¤„ç†æ•°ï¼ˆæ”¾å…¥ä»¤ç‰Œé€Ÿç‡ï¼‰
  */
private long putTokenRate;

/**
  * æœ€ååˆ·æ–°æ—¶é—´
  */
private long refreshTime;

/**
  * æ¡¶å®¹é‡
  */
private long capacity;

/**
  * å½“å‰æ¡¶å†…ä»¤ç‰Œæ•°
  */
private long currentToken = 0L;

/**
  * ä»¤ç‰Œæ¡¶ç®—æ³•
  * 
  * @return true - è¯·æ±‚åœ¨é˜ˆå€¼å†…ï¼Œæ­£å¸¸å“åº”
  */
boolean tokenBucketTryAcquire() {
  // è·å–å½“å‰æ—¶é—´
  long currentTime = System.currentTimeMillis();

  // è®¡ç®—ç”Ÿæˆçš„ä»¤ç‰Œæ•°é‡
  long elapsedTime = currentTime - refreshTime;
  long generatedTokens = elapsedTime * putTokenRate / 1000; // æ”¾å…¥ä»¤ç‰Œé€Ÿç‡æ˜¯æ¯ç§’å¤„ç†çš„ä»¤ç‰Œæ•°ï¼Œå› æ­¤éœ€è¦é™¤ä»¥1000è½¬æ¢ä¸ºæ¯«ç§’

  // è®¡ç®—å½“å‰ä»¤ç‰Œæ•°é‡ï¼Œä½†ä¸è¶…è¿‡æ¡¶çš„å®¹é‡
  currentToken = Math.min(capacity, currentToken + generatedTokens);

  // æ›´æ–°åˆ·æ–°æ—¶é—´
  refreshTime = currentTime;

  // åˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œå¤„ç†è¯·æ±‚
  if (currentToken > 0) {
    // æ¶ˆè€—ä¸€ä¸ªä»¤ç‰Œ
    currentToken--;
    return true;
  }

  // é™æµ
  return false;
}
```

å¦‚æœä»¤ç‰Œå‘æ”¾çš„ç­–ç•¥æ­£ç¡®ï¼Œè¿™ä¸ªç³»ç»Ÿå³ä¸ä¼šè¢«æ‹–å®ï¼Œä¹Ÿèƒ½æé«˜æœºå™¨çš„åˆ©ç”¨ç‡ã€‚Guavaçš„RateLimiteré™æµç»„ä»¶ã€Redissonçš„RRateLimiterç»„ä»¶ï¼Œå°±æ˜¯åŸºäº**ä»¤ç‰Œæ¡¶ç®—æ³•**å®ç°çš„ã€‚
